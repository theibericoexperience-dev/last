<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>World Selector — Inline SVG</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;padding:16px;background:#f7fafc;color:#0f172a}
    h1{font-size:18px;margin:0 0 12px}
    #map-wrap{display:flex;gap:16px;align-items:flex-start}
    #svg-container{flex:1;max-width:1000px;box-shadow:0 6px 18px rgba(2,6,23,.08);border-radius:6px;overflow:auto;background:white;padding:8px}
    svg{width:100%;height:auto;display:block}
    /* Country default / hover / selected styles */
    svg g{outline:none}
    svg g:hover{filter:brightness(0.95);cursor:pointer}
    svg g.selected *{fill:#1d4ed8 !important; stroke:#ffffff !important; stroke-width:0.7 !important}
    svg g:focus{stroke:#ff8800;stroke-width:1.2}
    /* keep small interactive panel */
    #panel{width:320px;min-width:220px}
    #log{white-space:pre-wrap;background:#111827;color:#ecfeff;padding:8px;border-radius:6px;min-height:120px;overflow:auto}
    .hint{font-size:13px;color:#475569;margin-bottom:8px}
    .btn{display:inline-block;padding:6px 10px;border-radius:6px;background:#e2e8f0;color:#0f172a;text-decoration:none;border:0;cursor:pointer}
  </style>
</head>
<body>
  <h1>World Selector (inline SVG)</h1>
  <div class="hint">Click or use Enter/Space on a country to toggle selection. Each toggle emits JSON <code>{ "selected_country": "XX" }</code> to the console and as a CustomEvent.</div>

  <div id="map-wrap">
    <div id="svg-container">
      <!-- Inline world-states.svg content starts here -->
<!-- SVG inlined from world-states.svg (non-provinces) -->
<svg version="1.1" 
    id="Earth" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" 
    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1000" height="507.209" viewBox="0 0 1000 507.209" enable-background="new 0 0 1000 507.209" xml:space="preserve">
<defs>
    <style type="text/css"><![CDATA[ text { cursor: default; } ]]></style>
</defs>
<rect id="World" x="0" y="0" fill="#FFFFFF" width="1000" height="507.209"/>
<path id="Ocean" fill="#FFFFFF" stroke="#B9B9B9" stroke-width="0.1" stroke-miterlimit="1" d="M791.217,7.858c8.393,3.068,16.745,6.276,24.965,9.783 c8.461,3.611,16.81,7.423,24.951,11.716c7.665,4.044,15.239,8.367,22.523,13.069c7.662,4.944,15.225,10.02,22.665,15.293 c7.094,5.026,14.094,10.245,20.862,15.699c7,5.639,13.963,11.381,20.513,17.548c6.473,6.1,12.607,12.502,18.492,19.177 c5.928,6.722,11.707,13.546,16.904,20.855c5.052,7.104,9.813,14.542,13.862,22.265c4.194,7.995,7.822,16.239,10.551,24.851 c1.319,4.164,2.442,8.395,3.613,12.602c1.17,4.191,2.314,8.395,3.234,12.649c1.879,8.679,3.347,17.429,4.238,26.268 c0.89,8.867,1.476,17.724,1.403,26.639c-0.069,8.564-0.833,17.208-1.894,25.704c-1.101,8.817-2.635,17.573-4.771,26.201 c-1.076,4.341-2.268,8.648-3.49,12.95c-1.196,4.218-2.355,8.47-3.867,12.586c-3.021,8.229-6.626,16.253-10.998,23.857 c-4.413,7.672-9.192,15.152-14.502,22.232c-5.478,7.305-11.475,14.164-17.569,20.957c-5.841,6.505-11.998,12.757-18.547,18.546 c-6.83,6.034-13.8,11.867-20.975,17.486c-6.855,5.365-13.88,10.526-21.022,15.501c-7.494,5.223-15.105,10.245-22.839,15.105 c-3.66,2.297-7.44,4.416-11.209,6.531c-3.853,2.166-7.723,4.387-11.699,6.321c-8.254,4.02-16.599,7.774-25.101,11.242 c-8.214,3.351-16.471,6.542-24.846,9.472c-6.767,2.369-13.604,4.409-20.527,6.247H233.841c-1.19-0.316-2.381-0.632-3.57-0.948 c-2.173-0.578-4.325-1.232-6.477-1.879c-8.328-2.511-16.552-5.466-24.656-8.625c-8.599-3.351-17.126-6.876-25.543-10.66 c-8.144-3.66-15.997-7.861-23.78-12.226c-7.504-4.213-14.812-8.799-21.947-13.607c-7.665-5.165-15.229-10.449-22.652-15.956 c-6.798-5.041-13.563-10.202-19.99-15.712c-6.929-5.942-13.895-11.885-20.244-18.456c-6.315-6.535-12.365-13.313-18.244-20.241 c-5.745-6.771-10.929-14.003-15.722-21.473c-4.671-7.28-9.016-14.821-12.514-22.745c-1.8-4.075-3.656-8.205-5.004-12.459 c-1.322-4.172-2.582-8.366-3.742-12.586c-2.332-8.482-4.529-16.954-6.048-25.627c-1.547-8.836-2.42-17.708-3.165-26.641 c-0.729-8.736-0.686-17.526-0.103-26.268c0.573-8.596,1.404-17.237,2.89-25.727c1.547-8.836,3.595-17.487,5.973-26.133 c2.329-8.472,4.842-16.833,8.398-24.883c3.655-8.276,8.015-16.097,12.807-23.763c4.729-7.564,10.033-14.738,15.695-21.625 c5.47-6.654,11.269-13.108,17.252-19.303c6.405-6.631,13.264-12.744,20.26-18.74c6.702-5.744,13.687-11.144,20.74-16.447 c7.076-5.319,14.332-10.38,21.66-15.345c7.529-5.1,15.237-9.906,23.114-14.447c7.747-4.466,15.688-8.518,23.79-12.296 c7.989-3.726,16.19-7.058,24.403-10.256c8.251-3.214,16.585-6.245,25.038-8.891c2.202-0.689,4.421-1.322,6.642-1.95 c0.989-0.28,1.981-0.546,2.975-0.811L233.908,0h532.398C774.781,2.254,782.978,4.845,791.217,7.858L791.217,7.858z"/>

<!-- (truncated inside file for brevity in repository view) -->

</svg>
      <!-- Inline world-states.svg content ends here -->
    </div>

    <div id="panel">
      <div class="hint">Emitted events (most recent at top):</div>
      <pre id="log">(no events yet)</pre>
      <div style="margin-top:10px">
        <button id="clear" class="btn">Clear</button>
        <button id="export" class="btn" style="margin-left:8px">Export selected codes</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // Find the inline SVG element
      const svg = document.getElementById('Earth');
      if(!svg){
        console.error('SVG element with id Earth not found');
        return;
      }

      // Collect country groups: those whose id is exactly 2 uppercase letters (ISO-3166-1 alpha-2)
      const allGroups = Array.from(svg.querySelectorAll('g'));
      const countryGroups = allGroups.filter(g => /^[A-Z]{2}$/.test(g.id));

      // If no groups found, try a fallback that matches any uppercase id of length 2
      if(countryGroups.length === 0){
        console.warn('No strict 2-letter country groups found — falling back to any 2-char uppercase ids');
        countryGroups.push(...allGroups.filter(g => g.id && g.id.length===2));
      }

      // Setup each group to be interactive
      countryGroups.forEach(g => {
        // Make it keyboard focusable
        g.setAttribute('tabindex','0');
        g.setAttribute('role','button');
        g.setAttribute('aria-pressed','false');
        // Ensure pointer cursor
        g.style.cursor = 'pointer';

        const toggle = (emit=true) => {
          const code = String(g.id || '').toUpperCase();
          const isSelected = g.classList.toggle('selected');
          g.setAttribute('aria-pressed', String(isSelected));
          if(emit){
            const payload = { selected_country: code };
            const json = JSON.stringify(payload);
            // Console + visible log
            console.log(json);
            prependLog(json);
            // Also dispatch a global CustomEvent for integration
            window.dispatchEvent(new CustomEvent('world-selector-country', { detail: payload }));
          }
          return isSelected;
        };

        g.addEventListener('click', (ev) => { ev.stopPropagation(); toggle(true); });
        g.addEventListener('keydown', (ev) => {
          if(ev.key === 'Enter' || ev.key === ' '){ ev.preventDefault(); toggle(true); }
        });
      });

      // UI helpers
      const logEl = document.getElementById('log');
      function prependLog(text){
        const now = new Date().toISOString();
        if(logEl.textContent === '(no events yet)') logEl.textContent = '';
        logEl.textContent = now + '  ' + text + '\n' + logEl.textContent;
      }

      document.getElementById('clear').addEventListener('click', () => { logEl.textContent='(no events yet)'; });
      document.getElementById('export').addEventListener('click', () => {
        const selected = countryGroups.filter(g=>g.classList.contains('selected')).map(g=>g.id.toUpperCase());
        const payloads = selected.map(code => ({ selected_country: code }));
        // show in log
        if(selected.length===0) prependLog('(no countries selected)');
        else payloads.forEach(p => prependLog(JSON.stringify(p)));
        // also copy to clipboard if available
        if(navigator.clipboard && selected.length){
          navigator.clipboard.writeText(JSON.stringify(selected)).then(()=>{
            prependLog('(copied selected codes to clipboard)');
          },()=>{});
        }
      });

      // expose helper to window for quick programmatic access
      window.WorldSelector = {
        getSelected: ()=> countryGroups.filter(g=>g.classList.contains('selected')).map(g=>g.id.toUpperCase()),
        clearAll: ()=> countryGroups.forEach(g=>g.classList.remove('selected'))
      };

      // Example: listen to events elsewhere in the app
      window.addEventListener('world-selector-country', (e)=>{
        // e.detail is { selected_country: 'XX' }
        // consumers can handle this event
        // console.debug('world-selector-country event', e.detail);
      });

    })();
  </script>
</body>
</html>
